/**************************************************************************************
*串口通信实验			  *
实现现象：下载程序后打开串口调试助手，将波特率设置为4800，选择发送的数据就可以显示
			在串口助手上。
注意事项：无。																				  
***************************************************************************************/

#include "reg52.h"			 //此文件中定义了单片机的一些特殊功能寄存器

typedef unsigned int u16;	  //对数据类型进行声明定义
typedef unsigned char u8;

sbit LED1=P2^0;
u8 flag,receiveData;
/*******************************************************************************
* 函数名         :UsartInit()
* 函数功能		   :设置串口
* 输入           : 无
* 输出         	 : 无
*******************************************************************************/
void UsartInit()
{
    TMOD = 0x20;
    SCON = 0x50;
    TH1 = 0xFD;	 //设置波特率为9600
    TL1 = TH1;
    PCON = 0x00;
    EA = 1;
    ES = 1;
    TR1 = 1;
}
void SendOneByte()
{
	SBUF=receiveData;//将接收到的数据放入到发送寄存器
	while(!TI);			 //等待发送数据完成
	TI=0;						 //清除发送完成标志位
}
/*******************************************************************************
* 函 数 名       : main
* 函数功能		 : 主函数
* 输    入       : 无
* 输    出    	 : 无
*******************************************************************************/
void main()
{	
	UsartInit();  //	串口初始化
	while(1)
	{
		if(flag==1)
		{
			ES=0;
			flag=0;
			SendOneByte();
			ES=1;
		}
	
	}		
}

/*******************************************************************************
* 函数名         : Usart() interrupt 4
* 函数功能		 : 串口通信中断函数
* 输入           : 无
* 输出         	 : 无
*******************************************************************************/
void Usart() interrupt 4
{
	if(RI)
	{
		RI = 0;//清除接收中断标志位
		receiveData=SBUF;//出去接收到的数据	
		flag=1;
		//P2=receiveData;
		switch(receiveData)
		{
			case 0xf9:
				LED1=0;
				break;
			case 0xfa:
				LED1=1;
				break;
		}
	}	
}