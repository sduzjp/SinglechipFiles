C51 COMPILER V9.01   LCD1602                                                               05/04/2020 15:48:38 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN LCD1602.OBJ
COMPILER INVOKED BY: D:\keil_v4\C51\BIN\C51.EXE LCD1602.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //变量定义
   2          #include "reg51.h"
   3          #include "intrins.h"//包含_nop_()函数
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          uchar code line1_data[]="Hello Everyone";//要显示的第一行字符
   7          uchar code line2_data[]="Welcome to SDU!";//要显示的第二行字符
   8          sbit LCD_RS=P1^7;         //定义控制引脚
   9          sbit LCD_RW=P1^6;
  10          sbit LCD_EN=P1^5;
  11          uchar flag=0;
  12          
  13          //延时子程序
  14          void delay_ms(uint xms)
  15          {
  16   1              uint i,j;
  17   1              for(i=xms;i>0;i--)
  18   1              {
  19   2                      for(j=110;j>0;j--);
  20   2              }
  21   1      }
  22          
  23          //LCD忙检查子程序
  24          bit lcd_busy()
  25          {
  26   1              bit result;
  27   1              LCD_RS=0;
  28   1              LCD_RW=1;
  29   1              LCD_EN=1;
  30   1              _nop_();
  31   1              _nop_();
  32   1              _nop_();
  33   1              _nop_();
  34   1              result=(bit)(P2&0X80);
  35   1              LCD_EN=0;
  36   1              return result;
  37   1      }
  38          
  39          //写命令子程序
  40          void lcd_wcmd(uchar cmd)
  41          {
  42   1              while(lcd_busy());
  43   1              LCD_RS=0;
  44   1              LCD_RW=0;
  45   1              LCD_EN=0;
  46   1              _nop_();
  47   1              _nop_();
  48   1              P2=cmd;
  49   1              _nop_();
  50   1              _nop_();
  51   1              _nop_();
  52   1              _nop_();
  53   1              LCD_EN=1;
  54   1              _nop_();
  55   1              _nop_();
C51 COMPILER V9.01   LCD1602                                                               05/04/2020 15:48:38 PAGE 2   

  56   1              _nop_();
  57   1              _nop_();
  58   1              LCD_EN=0;
  59   1      }
  60          
  61          //LCD清屏子程序
  62          void lcd_clr()
  63          {
  64   1              lcd_wcmd(0x01);
  65   1              delay_ms(2);
  66   1      }
  67          
  68          //写数据子程序
  69          void lcd_wdat(uchar dat)
  70          {
  71   1              while(lcd_busy());
  72   1              LCD_RS=1;
  73   1              LCD_RW=0;
  74   1              LCD_EN=0;
  75   1              _nop_();
  76   1              _nop_();
  77   1              P2=dat;
  78   1              _nop_();
  79   1              _nop_();
  80   1              _nop_();
  81   1              _nop_();
  82   1              LCD_EN=1;
  83   1              _nop_();
  84   1              _nop_();
  85   1              _nop_();
  86   1              _nop_();
  87   1              LCD_EN=0;
  88   1      }
  89          
  90          //初始化子程序
  91          void lcd_init()
  92          {
  93   1              delay_ms(15);//等待LCD电源稳定
  94   1              lcd_wcmd(0x38);//功能设定指令中DL=1,N=1,F=0，8位数据宽度，16*2显示，5*7点阵字符
  95   1              delay_ms(5);
  96   1              lcd_wcmd(0x0c);//显示开关控制指令中D=1,C=0,B=0，显示开，关光标，不闪烁
  97   1              delay_ms(5);
  98   1              lcd_wcmd(0x06);//进入模式设置指令中I/D=1,S=0,地址自动增加
  99   1              delay_ms(5);
 100   1              lcd_wcmd(0x01);//清除LCD显示内容，清屏指令DB7-DB0部分为01H
 101   1              delay_ms(5);
 102   1      }
 103          
 104          //闪烁子程序
 105          void flash()
 106          {
 107   1              delay_ms(1000);
 108   1              lcd_wcmd(0x08);//显示开关控制指令中D=0,C=0,B=0,显示关，关光标，不闪烁
 109   1              delay_ms(500);
 110   1              lcd_wcmd(0x0c);//显示开，关光标，不闪烁
 111   1              delay_ms(500);
 112   1              lcd_wcmd(0x08);
 113   1              delay_ms(500);
 114   1              lcd_wcmd(0x0c);
 115   1              delay_ms(500);
 116   1              lcd_wcmd(0x08);
 117   1              delay_ms(500);
C51 COMPILER V9.01   LCD1602                                                               05/04/2020 15:48:38 PAGE 3   

 118   1              lcd_wcmd(0x0c);
 119   1              delay_ms(500);
 120   1      }
 121          
 122          //主程序
 123          void main()
 124          {
 125   1              uchar i;
 126   1              EA=1;   //打开中断总开关
 127   1              EX0=1;  //打开外部中断0
 128   1              IT0=1;  //设置中断触发方式为下降沿触发方式
 129   1              EX1=1;
 130   1              IT1=1;
 131   1              delay_ms(10);
 132   1              lcd_init();             //初始化
 133   1              lcd_clr();              //清屏
 134   1              delay_ms(5);
 135   1              while(1)
 136   1              {
 137   2                      if(flag==1)
 138   2                      {
 139   3                              lcd_wcmd(0x00|0x80);    //DDRAM地址设置指令，显示位置为第1行第0列
 140   3                              i=0;
 141   3                              while(line1_data[i]!='\0')
 142   3                              {
 143   4                                      lcd_wdat(line1_data[i]);        //加载第1行字符
 144   4                                      delay_ms(100);
 145   4                                      i++;
 146   4                              }
 147   3                              lcd_wcmd(0x40|0x80);    //设置显示位置为第2行第0列
 148   3                              i=0;
 149   3                              while(line2_data[i]!='\0')
 150   3                              {
 151   4                                       lcd_wdat(line2_data[i]);       //加载第2行字符
 152   4                                      delay_ms(100);
 153   4                                      i++;
 154   4                              }
 155   3                              flash();
 156   3                              flag=0;
 157   3                      }
 158   2                      if(flag==2)
 159   2                      {
 160   3                              lcd_clr();              //清屏
 161   3                              delay_ms(5);
 162   3                              flag=0;
 163   3                      }
 164   2              }
 165   1      }                               
 166          
 167          //外部中断0子程序
 168          void INT_0() interrupt 0
 169          {
 170   1              flag=1;
 171   1      }
 172          //外部中断1子程序
 173          void INT_1() interrupt 1
 174          {
 175   1              flag=2;
 176   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.01   LCD1602                                                               05/04/2020 15:48:38 PAGE 4   

   CODE SIZE        =    345    ----
   CONSTANT SIZE    =     31    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
